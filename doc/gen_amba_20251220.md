# GEN_AMBA User Manual
## Version 2025.12.20
### Enhanced AXI4/AXI3, AHB, and APB Bus Generator Suite

---

## Table of Contents
1. [Introduction](#introduction)
2. [What's New in 2025](#whats-new-in-2025)
3. [Installation](#installation)
4. [AXI Generator (gen_amba_axi)](#axi-generator)
5. [AHB Generator (gen_amba_ahb)](#ahb-generator)
6. [APB Generator (gen_amba_apb)](#apb-generator)
7. [Advanced Features](#advanced-features)
8. [GUI Interface](#gui-interface)
9. [Verification](#verification)
10. [Examples](#examples)

---

## 1. Introduction

GEN_AMBA is a comprehensive suite of RTL generators for AMBA bus systems, creating synthesizable Verilog code for AXI4/AXI3, AHB, and APB interconnects. The 2025 release includes major enhancements for advanced SoC development.

### Key Features
- **AXI4/AXI3**: Full protocol support with advanced features
- **AHB/AHB-Lite**: Complete bus matrix generation
- **APB**: Bridge generation from AXI or AHB
- **GUI Interface**: Visual bus matrix designer
- **Verification IP**: Complete UVM-based VIP suite

### Authors
- Original (2016-2021): Ando Ki (andoki@gmail.com)
- Enhanced (2025): Extended by AI-assisted development

---

## 2. What's New in 2025

### Major Enhancements

#### 2.1 Quality of Service (QoS) ✅
- 4-bit AWQOS/ARQOS signals
- Priority-based arbitration
- Starvation prevention
- Round-robin within same QoS level
- Debug monitoring

#### 2.2 REGION Support ✅
- 4-bit AWREGION/ARREGION signals
- 16 regions per slave
- Per-region protection attributes
- Per-region cache policies
- Address boundary checking

#### 2.3 USER Signals ✅
- Configurable width (1-1024 bits)
- All five USER signals supported
- Transparent routing through interconnect

#### 2.4 ACE-Lite Coherency ✅
- Domain signals (AWDOMAIN, ARDOMAIN)
- Snoop signals (AWSNOOP, ARSNOOP)
- Barrier signals (AWBAR, ARBAR)
- Cache maintenance detection
- Coherency validation

#### 2.5 Security Firewall ✅
- AxPROT[1] security bit validation
- SLVERR response generation
- Master/slave security levels
- Address-based protection
- Violation tracking and alerts

#### 2.6 Enhanced Address Width ✅
- Full 8-64 bit range support
- No longer limited to 4 fixed values
- Per AXI4 specification compliance

#### 2.7 GUI Interface ✅
- Visual bus matrix designer
- Drag-and-drop configuration
- Real-time validation
- Code generation
- Project management

#### 2.8 Verification IP Suite ✅
- UVM-based environment
- 80+ test sequences
- BFM components
- Coverage and scoreboard
- Regression management

---

## 3. Installation

### Prerequisites
- Linux, Windows (Cygwin/MinGW), or macOS
- GCC compiler
- Make utility
- Python 3.6+ (for GUI)

### Building from Source
```bash
# Clone or extract the repository
cd gen_amba_2025

# Build all generators
make

# Build specific generator
cd gen_amba_axi && make
cd gen_amba_ahb && make
cd gen_amba_apb && make

# Install to bin directory
make install
```

### Directory Structure
```
gen_amba_2025/
├── gen_amba_axi/     # AXI generator
├── gen_amba_ahb/     # AHB generator
├── gen_amba_apb/     # APB generator
├── axi4_vip/         # Verification IP
├── doc/              # Documentation
└── bin/              # Compiled binaries
```

---

## 4. AXI Generator (gen_amba_axi)

### Basic Usage
```bash
gen_amba_axi --master=<num> --slave=<num> [options]
```

### Command-Line Options

#### Required Parameters
- `-M, --master=<num>`: Number of masters (minimum 2)
- `-S, --slave=<num>`: Number of slaves (minimum 2)

#### Optional Parameters
- `-O, --output=<file>`: Output filename (default: stdout)
- `-D, --module=<name>`: Module name (default: amba_axi_mXsY)
- `-P, --prefix=<str>`: Module prefix for namespace
- `-3, --axi3`: Generate AXI3 (default: AXI4)
- `-A, --addr-width=<8-64>`: Address width in bits
- `-W, --data-width=<32-1024>`: Data width (32,64,128,256,512,1024)

#### Advanced Features (New in 2025)
- `-q, --enable-qos`: Enable Quality of Service
- `-r, --enable-region`: Enable REGION support
- `-u, --enable-user`: Enable USER signals
- `-f, --enable-firewall`: Enable security firewall
- `-c, --enable-cdc`: Enable clock domain crossing
- `-a, --enable-ace-lite`: Enable ACE-Lite coherency
- `-Q, --qos-width=<num>`: QoS signal width (default: 4)
- `-R, --region-width=<num>`: REGION width (default: 4)
- `-U, --user-width=<num>`: USER signal width (default: 1)

### Examples

#### Basic 2x3 Interconnect
```bash
gen_amba_axi --master=2 --slave=3 --output=axi_2x3.v
```

#### AXI4 with QoS and REGION
```bash
gen_amba_axi --master=4 --slave=4 --enable-qos --enable-region \
             --addr-width=40 --data-width=128 --output=axi_advanced.v
```

#### Secure System with Firewall
```bash
gen_amba_axi --master=4 --slave=4 --enable-firewall --enable-user \
             --user-width=8 --output=axi_secure.v
```

#### ACE-Lite Coherent System
```bash
gen_amba_axi --master=4 --slave=4 --enable-ace-lite --enable-qos \
             --output=axi_coherent.v
```

### Generated Module Interface

```verilog
module amba_axi_m4s4
    #(parameter NUM_MASTER  = 4
             , NUM_SLAVE   = 4
             , WIDTH_ID    = 4
             , WIDTH_AD    = 32
             , WIDTH_DA    = 32
             // Advanced parameters (2025)
             , WIDTH_QOS   = 4
             , WIDTH_REGION= 4
             , WIDTH_USER  = 8
             )
(
    input  ACLK,
    input  ARESETn,
    // Master ports
    // ... AXI signals ...
    // QoS signals (if enabled)
    input  [3:0] M0_AWQOS,
    input  [3:0] M0_ARQOS,
    // REGION signals (if enabled)
    input  [3:0] M0_AWREGION,
    input  [3:0] M0_ARREGION,
    // USER signals (if enabled)
    input  [WIDTH_USER-1:0] M0_AWUSER,
    // ACE-Lite signals (if enabled)
    input  [1:0] M0_AWDOMAIN,
    input  [2:0] M0_AWSNOOP,
    // ... more signals ...
);
```

---

## 5. AHB Generator (gen_amba_ahb)

### Basic Usage
```bash
gen_amba_ahb --mst=<num> --slv=<num> [options]
```

### Command-Line Options
- `--mst=<num>`: Number of masters (1 generates AHB-Lite)
- `--slv=<num>`: Number of slaves
- `--out=<file>`: Output filename
- `--module=<name>`: Module name
- `--prefix=<str>`: Module prefix

### Example
```bash
gen_amba_ahb --mst=3 --slv=4 --out=ahb_3x4.v
```

---

## 6. APB Generator (gen_amba_apb)

### Basic Usage
```bash
gen_amba_apb --slave=<num> [--axi|--ahb] [options]
```

### Command-Line Options
- `--slave=<num>`: Number of APB slaves
- `--axi`: Generate AXI-to-APB bridge
- `--ahb`: Generate AHB-to-APB bridge
- `--out=<file>`: Output filename

### Examples
```bash
# AXI to APB bridge with 8 slaves
gen_amba_apb --axi --slave=8 --out=axi2apb.v

# AHB to APB bridge with 4 slaves
gen_amba_apb --ahb --slave=4 --out=ahb2apb.v
```

---

## 7. Advanced Features

### 7.1 Quality of Service (QoS)

#### Overview
QoS enables priority-based arbitration in AXI4 systems.

#### Features
- 16 priority levels (0-15)
- Higher values get higher priority
- Starvation prevention
- Fair round-robin within same priority

#### Implementation
```verilog
// QoS signals in master interface
input [3:0] M0_AWQOS,  // Write priority
input [3:0] M0_ARQOS,  // Read priority

// Arbiter uses QoS for selection
if (m0_awqos > m1_awqos) 
    grant <= master_0;
```

### 7.2 REGION Support

#### Overview
REGION allows slaves to have multiple logical interfaces with different attributes.

#### Features
- 16 regions per slave (0-15)
- Per-region protection settings
- Per-region cache policies
- Address boundary validation

#### Configuration
```verilog
// Each slave can decode regions
s0_region_base[0] = 32'h0000_0000;  // Region 0 base
s0_region_size[0] = 32'h0000_1000;  // 4KB size
s0_region_prot[0] = 3'b010;         // Protection
```

### 7.3 USER Signals

#### Overview
USER signals carry sideband information alongside transactions.

#### Supported Signals
- AWUSER: Write address user
- WUSER: Write data user
- BUSER: Write response user
- ARUSER: Read address user
- RUSER: Read data user

#### Usage
```bash
gen_amba_axi --enable-user --user-width=16 ...
```

### 7.4 ACE-Lite Coherency

#### Overview
ACE-Lite adds cache coherency support for I/O coherent masters.

#### Signals
- **Domain**: Shareability (Non/Inner/Outer/System)
- **Snoop**: Transaction type (WriteClean, ReadOnce, etc.)
- **Barrier**: Ordering constraints

#### Encodings
```verilog
// Domain values
2'b00: Non-shareable
2'b01: Inner shareable
2'b10: Outer shareable
2'b11: System

// Write snoop types
3'b000: WriteNoSnoop
3'b001: WriteLineUnique
3'b010: WriteClean
```

### 7.5 Security Firewall

#### Overview
Enforces security policies based on AxPROT and configuration.

#### Features
- AxPROT[1] security bit checking
- Master security levels
- Slave access permissions
- Address-based protection
- SLVERR response generation

#### Configuration
```verilog
// Security setup
master_secure = 4'b0011;     // M0,M1 secure
slave_secure = 4'b1100;      // S2,S3 secure
slave_nonsec_allowed = 4'b0100; // S2 allows non-secure
```

---

## 8. GUI Interface

### Overview
Visual bus matrix designer with drag-and-drop configuration.

### Features
- Interactive matrix design
- Real-time validation
- Parameter configuration
- Code generation
- Project management

### Running the GUI
```bash
cd axi4_vip/gui_v3
python3 src/main_gui_v3_streamlined.py
```

### GUI Capabilities
- **Matrix View**: Visual master-slave connections
- **Parameters**: Configure all bus parameters
- **Advanced Features**: Enable QoS, REGION, etc.
- **Generation**: Create RTL or command lines
- **Verification**: Generate VIP environment

---

## 9. Verification

### Simulation Support
- Icarus Verilog
- ModelSim/QuestaSim
- VCS
- Vivado XSIM
- Xcelium

### Running Tests
```bash
cd gen_amba_axi/verification/sim/iverilog
make MST=2 SLV=3
```

### Waveform Viewing
```bash
gtkwave wave.vcd
```

### UVM Verification IP
```bash
cd axi4_vip
make compile
./simv +UVM_TESTNAME=axi4_base_test
```

---

## 10. Examples

### Example 1: Basic AXI4 System
```bash
# Generate 4x4 AXI4 interconnect
gen_amba_axi --master=4 --slave=4 --output=basic_axi4.v
```

### Example 2: High-Performance System
```bash
# 64-bit data, 40-bit address, with QoS
gen_amba_axi --master=8 --slave=8 \
             --data-width=64 --addr-width=40 \
             --enable-qos --output=hp_system.v
```

### Example 3: Secure IoT System
```bash
# Security firewall with regions
gen_amba_axi --master=4 --slave=6 \
             --enable-firewall --enable-region \
             --enable-user --user-width=8 \
             --output=iot_secure.v
```

### Example 4: Coherent Multi-Core
```bash
# ACE-Lite with QoS for coherent system
gen_amba_axi --master=4 --slave=4 \
             --enable-ace-lite --enable-qos \
             --data-width=128 --addr-width=48 \
             --output=coherent_mc.v
```

### Example 5: Complete System
```bash
# All features enabled
gen_amba_axi --master=8 --slave=8 \
             --enable-qos --enable-region \
             --enable-user --user-width=16 \
             --enable-firewall --enable-ace-lite \
             --addr-width=64 --data-width=256 \
             --prefix=main_ --module=main_interconnect \
             --output=full_system.v
```

---

## Appendix A: Signal Reference

### Standard AXI4 Signals
| Signal | Width | Description |
|--------|-------|-------------|
| AxID | WIDTH_ID | Transaction ID |
| AxADDR | WIDTH_AD | Address |
| AxLEN | 8 | Burst length |
| AxSIZE | 3 | Burst size |
| AxBURST | 2 | Burst type |
| AxLOCK | 1 | Lock type |
| AxCACHE | 4 | Cache attributes |
| AxPROT | 3 | Protection |

### Enhanced Signals (2025)
| Signal | Width | Description |
|--------|-------|-------------|
| AxQOS | 4 | Quality of Service |
| AxREGION | 4 | Region identifier |
| AxUSER | 1-1024 | User-defined |
| AxDOMAIN | 2 | ACE-Lite domain |
| AxSNOOP | 3/4 | ACE-Lite snoop |
| AxBAR | 2 | ACE-Lite barrier |

---

## Appendix B: Error Responses

### Response Types
- **OKAY (2'b00)**: Normal access success
- **EXOKAY (2'b01)**: Exclusive access success
- **SLVERR (2'b10)**: Slave error/security violation
- **DECERR (2'b11)**: Decode error (no slave)

---

## Appendix C: Compliance

### Specifications Supported
- AMBA AXI4 Protocol v2.0 (ARM IHI 0022D)
- AMBA AXI3 Protocol v1.0 (ARM IHI 0022C)
- AMBA AHB Protocol v2.0 (ARM IHI 0011A)
- AMBA APB Protocol v2.0 (ARM IHI 0024C)
- ACE-Lite Protocol (ARM IHI 0022D)

### Synthesis Support
- Xilinx Vivado
- Intel Quartus
- Synopsys Design Compiler
- Cadence Genus

---

## Support and Contributing

### Documentation
- User Manual: This document
- CLAUDE.md: AI assistant guidelines
- API Reference: See source headers

### Known Issues
- None reported in 2025 release

### Future Enhancements
- AXI5 support
- CHI protocol support
- SystemVerilog interface option
- AMBA 5 features

---

## License

BSD 2-Clause License

Copyright (c) 2016-2021 Ando Ki
Copyright (c) 2025 Enhanced Features Contributors

---

## Revision History

### Version 2025.12.20
- Added QoS arbitration
- Added REGION support
- Added USER signals
- Added ACE-Lite coherency
- Added Security Firewall
- Enhanced address width support
- Added GUI interface
- Added VIP suite

### Version 2021.07.10
- Added AXI3 support
- Bug fixes

### Version 2016.03.26
- Initial release

---

**End of Document**